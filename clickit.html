<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>ClickIt - the game</title>
	<script type="text/javascript" src="../phaser/build/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
        canvas {
        	display: block;
        	margin: auto;
        	margin-top: 30px;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var sideBar;

var game = new Phaser.Game(520, 520, Phaser.AUTO, '', { preload: preload, create: create, update: update });

var buttons = [];
var delta = 70;
var goalMatrix = [];
//This variable tells wheter all changes have been made so an update of the buttons on the screen can occur or not.
var findChange = false;
var moves;
var move = 0;

function preload(){
	game.load.image('pink', 'assets/pinkdot.png');
	game.load.image('green', 'assets/greendot.png');
	game.load.image('blue', 'assets/bluedot.png');
	game.load.image('yellow', 'assets/yellowdot.png');

	game.stage.backgroundColor = '#eeeeee';
}

function create() {
    //  Here we'll create 8 times 8 of buttons evenly spaced apart
    for (var i = 0; i < 8; i++){
        buttons[i] = [];
        goalMatrix[i] = [];
    	for (var j = 0; j < 8; j++){
    		//Assign random values to a 8X8 matrix
    		var number = Math.floor((Math.random() * 4) + 1);

    		var image = assignFirstColor(number);

    		//  Create a button inside of the 'game' group, with the an image decided above.
        	buttons[i][j] = game.add.button(i * delta, j * delta, image, actionOnClick, this);
            goalMatrix[i][j] = false;
    	} 
    }

    moves = game.add.text(10, 10, 'Moves: 0', { font: '24px Arial', fill: '#000' });
}

//Assign color from number
function assignFirstColor(number){
	var image;
	if(number == 1){
		image = 'pink';
	}
	else if(number == 2){
		image = 'green';
	}
	else if(number == 3){
		image = 'blue';
	}
	else if(number == 4){
		image = 'yellow';
	}
	return image;
}

//Change color from string
function changeColorInGame(key){
    var image;
    if(key == 'yellow'){
        image = 'pink';
    }
    else if(key == 'pink'){
        image = 'green';
    }
    else if(key == 'green'){
        image = 'blue';
    }
    else if(key == 'blue'){
        image = 'yellow';
    }
    return image;
}


function getColorInt(colorString){
	var colorInt;
	if(colorString == 'pink'){
        colorInt = 1;
    }
    else if(colorString == 'green'){
    	colorInt = 2;
    }
    else if(colorString == 'blue'){
    	colorInt = 3;
    }
    else if(colorString == 'yellow'){
    	colorInt = 4;
    }
    return colorInt;
}


function actionOnClick (clickedButton) {
    //Check for position I and J in buttons
    var numberI = clickedButton.x/delta;
    var numberJ = clickedButton.y/delta;

    //Change color on the button that was clicked
    var newButtonImage = changeColorInGame(clickedButton.key);
    clickedButton.loadTexture(newButtonImage);

    //  Add counter for number of moves
    move += 1;

    //Check if the pressed button is on the edge
    if(numberI==7){
        var buttonLeft = buttons[numberI-1][numberJ];
        var newButtonLeftImage = changeColorInGame(buttonLeft.key);
        buttons[numberI-1][numberJ].loadTexture(newButtonLeftImage);
    }
    else if(numberI==0){
        var buttonRight = buttons[numberI+1][numberJ];
        var newButtonRightImage = changeColorInGame(buttonRight.key);
        buttons[numberI+1][numberJ].loadTexture(newButtonRightImage);
    }
    else{
        var buttonLeft = buttons[numberI-1][numberJ];
        var buttonRight = buttons[numberI+1][numberJ];
        var newButtonLeftImage = changeColorInGame(buttonLeft.key);
        var newButtonRightImage = changeColorInGame(buttonRight.key);
        buttons[numberI-1][numberJ].loadTexture(newButtonLeftImage);
        buttons[numberI+1][numberJ].loadTexture(newButtonRightImage);
    }
    if(numberJ==7){
        var buttonTop = buttons[numberI][numberJ-1];
        var newButtonTopImage = changeColorInGame(buttonTop.key);
        buttons[numberI][numberJ-1].loadTexture(newButtonTopImage);
    }
    else if(numberJ==0){
        var buttonBottom = buttons[numberI][numberJ+1];
        var newButtonBottomImage = changeColorInGame(buttonBottom.key);
        buttons[numberI][numberJ+1].loadTexture(newButtonBottomImage);
    }
    else{
        var buttonTop = buttons[numberI][numberJ-1];
        var buttonBottom = buttons[numberI][numberJ+1];
        var newButtonTopImage = changeColorInGame(buttonTop.key);
        var newButtonBottomImage = changeColorInGame(buttonBottom.key);
        buttons[numberI][numberJ-1].loadTexture(newButtonTopImage);
        buttons[numberI][numberJ+1].loadTexture(newButtonBottomImage);
    }


    findChainInRow();
}


function findChainInRow(){
    // 1. För varje rad
    for(var row = 0; row < 8; row++){
        console.log("Row " + row);

        // Counting how long chain has been found. If chain > 4 no need to check 4 & 5 and 6 & 7.
        var  chain = 1;

        // 2. Kolla om färg på plats 2 & 3 är samma
        var color_1 = getColorInt(buttons[1][row].key);
        var color_2 = getColorInt(buttons[2][row].key);

        // 2.a Om samma
        if(color_1 === color_2){
            chain++;
            console.log(+ color_1 + " ?= " + color_2);
            console.log("chain = " + chain);
            console.log("They are the same color!");
            //Kolla vänster och höger .... 
        }
        else{
            var color_3 = getColorInt(buttons[3][row].key);
            var color_4 = getColorInt(buttons[4][row].key);
        }
        
        // 3. Kolla om färg på plats 4 & 5 är samma
        if(color_3 === color_4 && chain < 4){
            console.log("Steg 3. Chain = " + chain);
            console.log(+ color_3 + " ?= " + color_4);
            console.log("They are the same!");
        }
        else{
            var color_5 = getColorInt(buttons[5][row].key);
            var color_6 = getColorInt(buttons[5][row].key);
        }

        // 4 . Kolla om färg på plats 6 & 7 är samma
        if(color_5 === color_6){

        }


        console.log("\n");

    }

    

    // 5. Börja om från 1.
}


/*
function findGoalInRow(){
    //console.log("findFGoalInRow()");
	var goal_1 = 1;
    var goal_2 = 1;
	var currentColor;
    var goalTracker;

	for (var row = 0; row < 8; row++){
        //goalMatrix = [false, false, false, false, false, false, false, false];
        currentColor = getColorInt(buttons[row][0].key);

		for(var col = 1; col < 8; col++){
            var nextColor = getColorInt(buttons[row][col].key);
			if(currentColor ===  nextColor){
				goal_1++;
                console.log("goal++ och goal = " + goal_1 );
			}
            else if(currentColor != nextColor){
                goal_1 = 1;
                console.log("reset goal = 1");
            }
            if(goal_1 === 4){
                console.log("TRUEEEEE! row = " + row);
                buttons[row][col].kill();
                buttons[row][col-1].kill();
                buttons[row][col-2].kill();
                buttons[row][col-3].kill();
                //goalMatrix = [true, true, true, true, true, true, true, true];
                goal_1 = 1;
                
            }
			currentColor = nextColor;
		}
        goal_1 = 1;
	}
}
*/

/*
function checkForWinner(symbol){
    for(var a = 0; a < 4; a++){
        if((buttons[winningCombinations[a][0]].key === symbol) 
            && (content[winningCombinations[a][1]] === symbol) 
            && (content[winningCombinations[a][2]] === symbol)){

            return true;
        }
    }
    return false;
}
*/




function findGoalInColumn(){
	var goal = 0;
}

function update() {

    //findGoalInRow();

    //Update number of moves
    moves.text = 'Moves: ' + move;
}

</script>
</body>
</html>